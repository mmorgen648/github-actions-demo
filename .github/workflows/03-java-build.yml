# Demo 3: Java Build Workflow (Maven)
# Datei: .github/workflows/java-build.yml

name: Java CI Pipeline

on:
  push:
    branches: [main]
  pull_request:

jobs:
  # Job 1: Build mit Maven
  build-maven:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'maven'  # Automatisches Maven-Caching!

      - name: Build with Maven
        run: mvn clean package -DskipTests

      - name: Run Tests
        run: mvn test

      - name: Upload JAR Artifact
        uses: actions/upload-artifact@v4
        with:
          name: application-jar
          path: target/*.jar
          retention-days: 7

      - name: Upload Test Reports
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-reports
          path: target/surefire-reports/

  # Job 2: Build mit Gradle (Alternative)
  build-gradle:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'  # Automatisches Gradle-Caching!

      - name: Make gradlew executable
        run: chmod +x ./gradlew

      - name: Build with Gradle
        run: ./gradlew build

      - name: Run Tests
        run: ./gradlew test

      - name: Upload JAR
        uses: actions/upload-artifact@v4
        with:
          name: gradle-jar
          path: build/libs/*.jar

  # Job 3: Matrix Strategy - Mehrere Java-Versionen
  test-matrix:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        java-version: [11, 17, 21]

    steps:
      - uses: actions/checkout@v4

      - name: Setup Java ${{ matrix.java-version }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ matrix.java-version }}
          distribution: 'temurin'
          cache: 'maven'

      - name: Run Tests on Java ${{ matrix.java-version }}
        run: mvn test

      - name: Display Java Version
        run: java -version

# BEISPIEL pom.xml (Maven):
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# <?xml version="1.0" encoding="UTF-8"?>
# <project xmlns="http://maven.apache.org/POM/4.0.0"
#          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
#          xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
#                              http://maven.apache.org/xsd/maven-4.0.0.xsd">
#     <modelVersion>4.0.0</modelVersion>
#
#     <groupId>com.example</groupId>
#     <artifactId>demo-app</artifactId>
#     <version>1.0.0</version>
#     <packaging>jar</packaging>
#
#     <properties>
#         <maven.compiler.source>17</maven.compiler.source>
#         <maven.compiler.target>17</maven.compiler.target>
#         <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
#     </properties>
#
#     <dependencies>
#         <!-- JUnit fÃ¼r Tests -->
#         <dependency>
#             <groupId>org.junit.jupiter</groupId>
#             <artifactId>junit-jupiter</artifactId>
#             <version>5.10.0</version>
#             <scope>test</scope>
#         </dependency>
#     </dependencies>
#
#     <build>
#         <plugins>
#             <plugin>
#                 <groupId>org.apache.maven.plugins</groupId>
#                 <artifactId>maven-compiler-plugin</artifactId>
#                 <version>3.11.0</version>
#             </plugin>
#             <plugin>
#                 <groupId>org.apache.maven.plugins</groupId>
#                 <artifactId>maven-surefire-plugin</artifactId>
#                 <version>3.1.2</version>
#             </plugin>
#         </plugins>
#     </build>
# </project>

# BEISPIEL build.gradle (Gradle):
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# plugins {
#     id 'java'
#     id 'application'
# }
#
# group = 'com.example'
# version = '1.0.0'
# sourceCompatibility = '17'
#
# repositories {
#     mavenCentral()
# }
#
# dependencies {
#     testImplementation 'org.junit.jupiter:junit-jupiter:5.10.0'
# }
#
# test {
#     useJUnitPlatform()
# }
#
# application {
#     mainClass = 'com.example.Main'
# }

# BEISPIEL PROJEKT-STRUKTUR:
# project/
# â”œâ”€â”€ .github/
# â”‚   â””â”€â”€ workflows/
# â”‚       â””â”€â”€ java-build.yml
# â”œâ”€â”€ src/
# â”‚   â”œâ”€â”€ main/
# â”‚   â”‚   â””â”€â”€ java/
# â”‚   â”‚       â””â”€â”€ com/
# â”‚   â”‚           â””â”€â”€ example/
# â”‚   â”‚               â””â”€â”€ Main.java
# â”‚   â””â”€â”€ test/
# â”‚       â””â”€â”€ java/
# â”‚           â””â”€â”€ com/
# â”‚               â””â”€â”€ example/
# â”‚                   â””â”€â”€ MainTest.java
# â”œâ”€â”€ pom.xml (oder build.gradle)
# â””â”€â”€ README.md

# BEISPIEL Main.java:
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# package com.example;
#
# public class Main {
#     public static void main(String[] args) {
#         System.out.println("Hello from Java!");
#     }
#
#     public static String greet(String name) {
#         return "Hello, " + name + "!";
#     }
# }

# BEISPIEL MainTest.java:
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# package com.example;
#
# import org.junit.jupiter.api.Test;
# import static org.junit.jupiter.api.Assertions.*;
#
# class MainTest {
#     @Test
#     void testGreet() {
#         String result = Main.greet("World");
#         assertEquals("Hello, World!", result);
#     }
# }

# ERKLÃ„RUNGEN FÃœR DOZENTEN:
#
# 1. Maven vs. Gradle:
#    - Maven: XML-basiert (pom.xml), weit verbreitet
#    - Gradle: Groovy/Kotlin-basiert (build.gradle), moderner
#    - Beide werden von GitHub Actions unterstÃ¼tzt
#
# 2. Java Distributions:
#    - temurin: Eclipse Adoptium (empfohlen, OpenJDK)
#    - zulu: Azul Zulu (OpenJDK)
#    - adopt: AdoptOpenJDK (deprecated)
#    - oracle: Oracle JDK (Lizenz beachten!)
#
# 3. Maven Commands:
#    - mvn clean: LÃ¶scht target/ Ordner
#    - mvn compile: Kompiliert Source Code
#    - mvn test: FÃ¼hrt Tests aus
#    - mvn package: Erstellt JAR/WAR
#    - mvn install: Installiert in lokales Repository
#    - mvn clean package: Alles neu bauen
#
# 4. Gradle Commands:
#    - ./gradlew build: Kompilieren + Tests + JAR
#    - ./gradlew test: Nur Tests
#    - ./gradlew clean: Cleanup
#    - ./gradlew assemble: Build ohne Tests
#
# 5. Caching:
#    - Maven: ~/.m2/repository
#    - Gradle: ~/.gradle/caches
#    - Automatisch mit cache: 'maven' oder cache: 'gradle'
#
# 6. Java-Versionen:
#    - Java 11: LTS (Long Term Support)
#    - Java 17: LTS (aktuell empfohlen)
#    - Java 21: LTS (neueste)
#
# 7. JAR-Files:
#    - Maven: target/*.jar
#    - Gradle: build/libs/*.jar
#    - KÃ¶nnen als Artifacts hochgeladen werden

# HÃ„UFIGE FEHLER:
#
# 1. "Could not find or load main class"
#    â†’ pom.xml: mainClass nicht definiert
#    â†’ LÃ¶sung: maven-jar-plugin konfigurieren
#
# 2. "The JAVA_HOME environment variable is not defined"
#    â†’ LÃ¶sung: setup-java@v4 verwenden (setzt automatisch)
#
# 3. "Permission denied: ./gradlew"
#    â†’ LÃ¶sung: chmod +x ./gradlew
#    â†’ Oder: Git LFS Attributes setzen
#
# 4. "Tests were compiled with Java 17 but running with Java 11"
#    â†’ LÃ¶sung: Matrix java-version checken
#    â†’ LÃ¶sung: pom.xml compiler source/target setzen
#
# 5. "No tests were executed!"
#    â†’ LÃ¶sung: maven-surefire-plugin hinzufÃ¼gen
#    â†’ LÃ¶sung: Test-Dateien mÃ¼ssen *Test.java heiÃŸen
#
# 6. Maven Download dauert ewig
#    â†’ LÃ¶sung: cache: 'maven' aktivieren!
#    â†’ Erste AusfÃ¼hrung: 2-3 Min
#    â†’ Mit Cache: 10-20 Sek

# PERFORMANCE-VERGLEICH:
#
# OHNE Cache (Maven):
# â”œâ”€ Setup Java:              10s
# â”œâ”€ Download Dependencies:  120s â† LANGSAM
# â”œâ”€ Compile:                 15s
# â”œâ”€ Tests:                   20s
# â””â”€ Total:                  165s
#
# MIT Cache (Maven):
# â”œâ”€ Setup Java:              10s
# â”œâ”€ Restore Cache:            5s
# â”œâ”€ Download New Deps:       10s â† Nur neue
# â”œâ”€ Compile:                 15s
# â”œâ”€ Tests:                   20s
# â””â”€ Total:                   60s
#
# Ersparnis: 63% schneller! ğŸš€

# MAVEN LIFECYCLE:
#
# validate â†’ compile â†’ test â†’ package â†’ verify â†’ install â†’ deploy
#            â†‘         â†‘      â†‘
#            |         |      â””â”€ Tests laufen hier
#            |         â””â”€ JAR wird erstellt
#            â””â”€ .class Dateien erstellt

# GRADLE TASKS:
#
# compileJava â†’ classes â†’ test â†’ jar â†’ build
#               â†‘         â†‘      â†‘
#               |         |      â””â”€ JAR erstellt
#               |         â””â”€ Tests laufen
#               â””â”€ Kompiliert

# DEMO-TIPPS:
#
# 1. Zeige pom.xml oder build.gradle
#    - ErklÃ¤re Dependencies
#    - ErklÃ¤re Plugins
#    - Zeige Java Version
#
# 2. Zeige Maven/Gradle Commands lokal
#    mvn clean package
#    ./gradlew build
#
# 3. Zeige JAR im target/ oder build/libs/
#    ls -lh target/*.jar
#    java -jar target/app-1.0.0.jar
#
# 4. Zeige Caching-Effekt
#    - Erste AusfÃ¼hrung: Lange
#    - Zweite AusfÃ¼hrung: Schnell
#
# 5. Zeige Matrix mit mehreren Java-Versionen
#    - 3 parallele Jobs
#    - Verschiedene Java-Versionen

# TROUBLESHOOTING LIVE DEMO:
#
# Problem: pom.xml nicht gefunden
# â†’ LÃ¶sung: Repository Root checken
# â†’ mvn -f path/to/pom.xml package
#
# Problem: Tests schlagen fehl
# â†’ LÃ¶sung: Mit -DskipTests bauen
# â†’ Tests separat fixen
#
# Problem: Gradle Wrapper fehlt
# â†’ LÃ¶sung: gradle wrapper generieren
# â†’ Oder: gradle statt ./gradlew

# VERGLEICH: MAVEN VS GRADLE
#
# Maven:
# âœ… Einfachere Syntax (XML)
# âœ… Weit verbreitet
# âœ… GroÃŸe Community
# âŒ Verbose
# âŒ Weniger flexibel
#
# Gradle:
# âœ… Moderne Syntax (DSL)
# âœ… Schneller (Incremental Builds)
# âœ… Flexibler
# âŒ Steilere Lernkurve
# âŒ GrÃ¶ÃŸere Builds

# BESTE PRACTICES:
#
# 1. Cache aktivieren (cache: 'maven')
# 2. -DskipTests nur fÃ¼r Build, Tests separat
# 3. Test Reports als Artifacts hochladen
# 4. Matrix fÃ¼r mehrere Java-Versionen
# 5. LTS Versionen nutzen (11, 17, 21)
